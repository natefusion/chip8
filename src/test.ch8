; TIME TO ACTUALLY DEFINE THE GRAMMER
; instructions and macros must be on their own line
; arguments for instructions or macros must be user defined variables,
; number literals, built-in variables, or labels

; no need to write "call". compiler will figure it out
; "break" will end a loop

def LINE_COUNT ( + ( + 3 2 ) 5 )
def FILL_COUNT 5

def x       v0
def y       v1
def px      v2
def py      v3
def dx      v4
def dy      v5
def counter v6

lab main
  set i point

  ( loop 
    set counter LINE_COUNT

    ( loop
      call somewhere
      h-line
      call somewhere
      call v-line
      add counter -1

      neq counter 0
    )

    set counter FILL_COUNT

    ( loop
      call somewhere
      call fill
      add counter -1

      neq counter 0
    )

    set v0 key
    clear
  )


lab somewhere
  rand x #xFF
  rand y #xFF

lab scan
  ( loop
    draw px py 1

    eq vf 0
      break
      
    add px dx
    add py dy
  )

  draw px py 1


lab v-line
  set px x
  set dx 0

  set py y
  set dy -1
  call scan

  set py y
  set dy 1
  add py dy
  call scan


lab h-line
  set py y
  set dy 0

  set px x
  set dx -1
  call scan

  set px y
  set dx 1
  add px dx
  call scan


lab fill
  ( loop
    h-line
    add y 1
    draw x y 1

    eq vf 0
      break
  )

  draw x y 1


lab point
  #x80